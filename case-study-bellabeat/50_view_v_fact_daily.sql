USE BellaBeat; GO CREATE OR ALTER VIEW dbo.v_fact_daily AS SELECT a.Id, a.activity_date, DATEPART(WEEKDAY, a.activity_date) AS weekday_num, DATENAME(WEEKDAY, a.activity_date) AS weekday_name, CASE WHEN DATENAME(WEEKDAY, a.activity_date) IN ('Saturday','Sunday') THEN 'Weekend' ELSE 'Weekday' END AS day_type, a.TotalSteps, a.SedentaryMinutes, a.VeryActiveMinutes, a.Calories, s.TotalMinutesAsleep, s.TotalTimeInBed, CASE WHEN s.TotalTimeInBed > 0 THEN 1.0 * s.TotalMinutesAsleep / s.TotalTimeInBed END AS sleep_efficiency FROM dbo.v_daily_activity a LEFT JOIN dbo.v_sleep s ON a.Id = s.Id AND a.activity_date = s.sleep_date;